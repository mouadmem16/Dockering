# sudo docker network create -d macvlan --subnet=192.168.11.0/24 --gateway=192.168.11.1 -o parent=eth0 macvlan_net
services:
  pihole:
    container_name: pihole
    image: pihole/pihole:2025.10.3
    ports: 
      - 192.168.11.254:53:53/tcp
      - 192.168.11.254:53:53/udp
      # Uncomment the line below if you are using Pi-hole as your DHCP server
      #- "67:67/udp"
      # Uncomment the line below if you are using Pi-hole as your NTP server
      #- "123:123/udp"
    environment:
      TZ: africa/casablanca
      FTLCONF_webserver_api_password: ${ADMIN_PASSWORD}
      # If using Docker's default `bridge` network setting the dns listening mode should be set to 'all'
      FTLCONF_dns_listeningMode: all
    volumes:
      - etc_pihole:/etc/pihole
      # Uncomment the below if you have custom dnsmasq config files that you want to persist. Not needed for most starting fresh with Pi-hole v6. 
      # If you're upgrading from v5 you and have used this directory before, you should keep it enabled for the first v6 container start to allow for a complete migration. 
      # It can be removed afterwards. Needs environment variable FTLCONF_misc_etc_dnsmasq_d: 'true'
      #- './etc-dnsmasq.d:/etc/dnsmasq.d'
    cap_add:
      []
      # See https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
      # Required if you are using Pi-hole as your DHCP server, else not needed
      # - NET_ADMIN
      # Required if you are using Pi-hole as your NTP client to be able to set the host's system time
      # - SYS_TIME
      # Optional, if Pi-hole should get some more processing time
      # - SYS_NICE
    restart: unless-stopped
    networks:
      macvlan_net:
        ipv4_address: 192.168.11.254
      public_network:
    labels:
      - traefik.enable=true
      - traefik.http.routers.dns.rule=Host(`dns.mouaad-ops.me`)
      - traefik.http.routers.dns.entrypoints=web
      - traefik.http.routers.dns.service=dns-web-svc
      - traefik.http.services.dns-web-svc.loadbalancer.server.port=80
networks:
  macvlan_net:
    external: true
  public_network:
    external: true
volumes:
  etc_pihole:
    driver: local
